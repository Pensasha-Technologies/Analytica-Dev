<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragment2 :: head">
<!-- Custom styles for this template-->
<link th:href="@{/css/sb-admin-2.min.css}" rel="stylesheet" />
</head>

<body id="page-top">

	<!-- Page Wrapper -->
	<div id="wrapper">

		<!-- Sidebar -->
		<ul th:replace="fragments :: sidebar" id="sidebar"></ul>
		<!-- End of Sidebar -->

		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">

			<!-- Main Content -->
			<div id="content">

				<!-- Sidebar Toggle (Topbar) -->
				<button id="sidebarToggleTop"
					class="btn btn-link d-md-none rounded-circle mr-3">
					<i class="fa fa-bars"></i>
				</button>

				<nav aria-label="breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"
							th:if="${activeUser.role.name == 'ADMIN'}"><a
							th:href="@{/adminHome}">Home</a></li>
						<li class="breadcrumb-item"
							th:if="${activeUser.role.name == 'DEPUTYPRINCIPAL'}"><a
							th:href="@{/schools/deputyPrincipal}">Home</a></li>
						<li class="breadcrumb-item"
							th:if="${activeUser.role.name == 'PRINCIPAL'}"><a
							th:href="@{/schools/principal}">Home</a></li>
						<li class="breadcrumb-item"><a
							th:href="@{/school/{code}(code=${school.code})}"
							th:text="${school.name}">School</a></li>
						<li class="breadcrumb-item"><a
							th:href="@{/schools/{code}/students(code=${school.code})}">Students</a></li>
						<li class="breadcrumb-item active" aria-current="page">Merit
							List</li>
					</ol>
				</nav>

				<!-- Begin Page Content -->
				<div class="container-fluid">

					<div class="d-flex flex-column">

						<div class="row d-flex justify-content-center">
							<h3 th:text="${school.name}">School Name</h3>
						</div>
						<div class="row d-flex justify-content-center">
							<h4 th:text="'Year: ' + ${year} + ' Form: ' + ${form}"></h4>
						</div>
						<div class="row d-flex justify-content-center">
							<h4 th:text="'Term: ' + ${term}"></h4>
						</div>

					</div>

					<div class="alert alert-danger" th:if="${fail}" th:text="${fail}">
						Student exists</div>

					<div class="alert alert-success" th:if="${success}"
						th:text="${success}">Student saved</div>

					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th scope="col">#</th>
									<th scope="col">First Name</th>
									<th scope="col">Third Name</th>
									<th scope="col">Adm No.</th>
									<th:block th:each="subject : ${subjects}">
										<th scope="col" th:text="${subject.initials}">subject</th>
									</th:block>
									<th scope="col">Total</th>
									<th scope="col">Average</th>
									<th scope="col">Grade</th>
									<th scope="col">Points</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="meritList, rank : ${meritLists}">
									<th scope="row" th:text="${rank.index + 1}">1</th>
									<td th:text="${meritList.firstname}"></td>
									<td th:text="${meritList.secondname}"></td>
									<td th:text="${#strings.substringAfter(meritList.admNo,'_')}"></td>
									<th:block th:each="subject : ${subjects}">
										<td th:text="${meritList.__${subject.initials}__}"
											th:if="${subject.initials != 'C.R.E'}"></td>
										<td th:text="${meritList.cre}"
											th:if="${subject.initials == 'C.R.E'}"></td>
									</th:block>
									<td th:text="${meritList.total}"></td>
									<td
										th:text="${#aggregates.avg(marks.?[student.admNo == '__${meritList.admNo}__'].![(cat1 + cat2)/2 + mainExam])}">Average</td>
									<td
										th:with="isEven=${#aggregates.avg(marks.?[student.admNo == '__${meritList.admNo}__'].![(cat1 + cat2)/2 + mainExam])}">
										<p th:if="${(isEven<=100 && isEven>=80 )}">A</p>
										<p th:if="${isEven<80 && isEven>=75}">A-</p>
										<p th:if="${isEven<75 && isEven>=70}">B+</p>
										<p th:if="${isEven<70 && isEven>=65}">B</p>
										<p th:if="${isEven<65 && isEven>=60}">B-</p>
										<p th:if="${isEven<60 && isEven>=55}">C+</p>
										<p th:if="${isEven<55 && isEven>=50}">C</p>
										<p th:if="${isEven<50 && isEven>=45}">C-</p>
										<p th:if="${isEven<45 && isEven>=40}">D+</p>
										<p th:if="${isEven<40 && isEven>=35}">D</p>
										<p th:if="${isEven<35 && isEven>=30}">D-</p>
										<p th:if="${isEven<30 && isEven>0}">E</p>
										<p th:if="${isEven == 0 }">...</p>
									</td>
									<td
										th:with="isOdd = ${#aggregates.avg(marks.?[student.admNo == '__${meritList.admNo}__'].![(cat1 + cat2)/2 + mainExam])}">
										<p th:if="${isOdd<=100 && isOdd>=80}">12</p>
										<p th:if="${isOdd<80 && isOdd>=75}">11</p>
										<p th:if="${isOdd<75 && isOdd>=70}">10</p>
										<p th:if="${isOdd<70 && isOdd>=65}">9</p>
										<p th:if="${isOdd<65 && isOdd>=60}">8</p>
										<p th:if="${isOdd<60 && isOdd>=55}">7</p>
										<p th:if="${isOdd<55 && isOdd>=50}">6</p>
										<p th:if="${isOdd<50 && isOdd>=45}">5</p>
										<p th:if="${isOdd<45 && isOdd>=40}">4</p>
										<p th:if="${isOdd<40 && isOdd>=35}">3</p>
										<p th:if="${isOdd<35 && isOdd>=30}">2</p>
										<p th:if="${isOdd<30 && isOdd>0}">1</p>
										<p th:if="${isOdd == 0 }">...</p>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

				</div>
				<!-- End of Main Content -->

				<!-- Footer -->
				<footer th:replace="fragments :: footer2"></footer>
				<!-- End of Footer -->


			</div>
			<!-- End of Content Wrapper -->

		</div>
		<!-- End of Page Wrapper -->

		<!-- Scroll to Top Button-->
		<a th:replace="fragments :: scroll"></a>

		<!-- Logout modal -->
		<div th:replace="fragments :: logoutModal"></div>

		<div th:replace="fragments :: endScript"></div>
</body>

</html>
