<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragment2 :: head">
<!-- Custom styles for this template-->
<link th:href="@{/css/sb-admin-2.min.css}" rel="stylesheet" />
</head>

<body id="page-top">

	<!-- Page Wrapper -->
	<div id="wrapper">

		<!-- Sidebar -->
		<ul th:replace="fragments :: sidebar" id="sidebar"></ul>
		<!-- End of Sidebar -->

		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">

			<!-- Main Content -->
			<div id="content">

				<!-- Sidebar Toggle (Topbar) -->
				<button id="sidebarToggleTop"
					class="btn btn-link d-md-none rounded-circle mr-3">
					<i class="fa fa-bars"></i>
				</button>

				<nav aria-label="breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"
							th:if="${activeUser.role.name == 'ADMIN'}"><a
							th:href="@{/adminHome}">Home</a></li>
						<li class="breadcrumb-item"
							th:if="${activeUser.role.name == 'DEPUTYPRINCIPAL'}"><a
							th:href="@{/schools/deputyPrincipal}">Home</a></li>
						<li class="breadcrumb-item"
							th:if="${activeUser.role.name == 'PRINCIPAL'}"><a
							th:href="@{/schools/principal}">Home</a></li>
						<li class="breadcrumb-item"><a
							th:href="@{/school/{code}(code=${school.code})}"
							th:text="${school.name}">School</a></li>
						<li class="breadcrumb-item"><a
							th:href="@{/schools/{code}/students(code=${school.code})}">Students</a></li>
						<li class="breadcrumb-item active" aria-current="page">Merit
							List</li>
					</ol>
				</nav>

				<!-- Begin Page Content -->
				<div class="container-fluid">

					<div class="d-flex flex-column">

						<div class="row d-flex justify-content-center">
							<h3 th:text="${school.name}">School Name</h3>
						</div>
						<div class="row d-flex justify-content-center">
							<h4 th:text="'Year: ' + ${year} + ' Form: ' + ${form}"></h4>
						</div>
						<div class="row d-flex justify-content-center">
							<h4 th:text="'Term: ' + ${term}"></h4>
						</div>

					</div>

					<div class="alert alert-danger" th:if="${fail}" th:text="${fail}">
						Student exists</div>

					<div class="alert alert-success" th:if="${success}"
						th:text="${success}">Student saved</div>

					<div style="padding: 10px;"
						th:if="${meritLists} and ${meritLists.size()}">
						<a
							th:href="@{/schools/{code}/years/{year}/forms/{form}/terms/{term}/meritList/pdf(code=${school.code},year=${year}, form=${form},term=${term})}"
							class="btn btn-primary"> Download</a>
					</div>

					<div class="table-responsive">
						<table class="table" style="font-size: 12px;">
							<thead>
								<tr>
									<th scope="col">Adm No.</th>
									<th scope="col">Name</th>
									<th scope="col">K.C.P.E</th>
									<th scope="col">Stream</th>
									<th:block th:each="subject : ${subjects}">
										<th scope="col" th:text="${subject.initials}">subject</th>
									</th:block>
									<th scope="col">Total</th>
									<th scope="col">Mean</th>
									<th scope="col">Grade</th>
									<th scope="col">Points</th>
									<th scope="col">Rank</th>
								</tr>
							</thead>
							<tbody>
								<div th:unless="${meritLists} and ${meritLists.size()}">
									<br>
									<p class="text text-center alert alert-warning">No Student
										Marks has been added</p>
								</div>
								<tr th:each="meritList, rank : ${meritLists}">
									<td th:text="${#strings.substringAfter(meritList.admNo,'_')}"></td>
									<td
										th:text="${meritList.firstname + ' ' + meritList.secondname}"></td>
									<td th:text="${meritList.kcpe}">kcpe</td>
									<td th:text="${meritList.stream}">stream</td>
									<th:block th:each="subject : ${subjects}">
										<td th:text="${meritList.__${subject.initials}__}"
											th:if="${subject.initials != 'C.R.E' || subject.initials != 'H.R.E' || subject.initials != 'I.R.E'}"></td>
										<td th:text="${meritList.cre}"
											th:if="${subject.initials == 'C.R.E'}"></td>
										<td th:text="${meritList.hre}"
											th:if="${subject.initials == 'H.R.E'}"></td>
										<td th:text="${meritList.ire}"
											th:if="${subject.initials == 'I.R.E'}"></td>
									</th:block>
									<td th:text="${meritList.total}"></td>
									<td th:text="${meritList.average}">Average</td>
									<td th:with="isEven=${meritList.average}">
										<p th:if="${(isEven<=100 && isEven>=80 )}">A</p>
										<p th:if="${isEven<80 && isEven>=75}">A-</p>
										<p th:if="${isEven<75 && isEven>=70}">B+</p>
										<p th:if="${isEven<70 && isEven>=65}">B</p>
										<p th:if="${isEven<65 && isEven>=60}">B-</p>
										<p th:if="${isEven<60 && isEven>=55}">C+</p>
										<p th:if="${isEven<55 && isEven>=50}">C</p>
										<p th:if="${isEven<50 && isEven>=45}">C-</p>
										<p th:if="${isEven<45 && isEven>=40}">D+</p>
										<p th:if="${isEven<40 && isEven>=35}">D</p>
										<p th:if="${isEven<35 && isEven>=30}">D-</p>
										<p th:if="${isEven<30 && isEven>0}">E</p>
										<p th:if="${isEven == 0 }">...</p>
									</td>
									<td th:with="isOdd = ${meritList.average}">
										<p th:if="${isOdd<=100 && isOdd>=80}">12</p>
										<p th:if="${isOdd<80 && isOdd>=75}">11</p>
										<p th:if="${isOdd<75 && isOdd>=70}">10</p>
										<p th:if="${isOdd<70 && isOdd>=65}">9</p>
										<p th:if="${isOdd<65 && isOdd>=60}">8</p>
										<p th:if="${isOdd<60 && isOdd>=55}">7</p>
										<p th:if="${isOdd<55 && isOdd>=50}">6</p>
										<p th:if="${isOdd<50 && isOdd>=45}">5</p>
										<p th:if="${isOdd<45 && isOdd>=40}">4</p>
										<p th:if="${isOdd<40 && isOdd>=35}">3</p>
										<p th:if="${isOdd<35 && isOdd>=30}">2</p>
										<p th:if="${isOdd<30 && isOdd>0}">1</p>
										<p th:if="${isOdd == 0 }">...</p>
									</td>
									<th scope="row" th:text="${rank.index + 1}">1</th>
								</tr>
							</tbody>
						</table>
					</div>

					<div style="text-align: center;">
						<h4>Subject Means/Averages</h4>
					</div>

					<div class="table-responsive" style="padding: 20px;">
						<table class="table">
							<thead>
								<tr>
									<th></th>
									<th:block th:each="subject : ${subjects}">
										<th scope="col" th:text="${subject.initials}">subject</th>
									</th:block>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>Mean</td>
									<th:block th:each="subject : ${subjects}">
										<td scope="col"
											th:text="${(#aggregates.sum(meritLists.![cre]))/creCount}"
											th:if="${subject.initials == 'C.R.E' && creCount > 0}">-</td>
										<td scope="col"
											th:text="${(#aggregates.sum(meritLists.![hre]))/hreCount}"
											th:if="${subject.initials == 'H.R.E' && hreCount > 0}">-</td>
										<td scope="col"
											th:text="${(#aggregates.sum(meritLists.![ire]))/ireCount}"
											th:if="${subject.initials == 'I.R.E' && ireCount > 0}">-</td>
										<th:block
											th:unless="${subject.initials == 'C.R.E' || subject.initials == 'H.R.E' || subject.initials == 'I.R.E'}">
											<td scope="col"
												th:text="${(#aggregates.sum(meritLists.![__${subject.initials}__]))/__${subject.initials}__Count}"
												th:if="${__${subject.initials}__Count > 0}">-</td>
										</th:block>
									</th:block>

								</tr>
								<tr>
									<td>Entry</td>
									<th:block th:each="subject : ${subjects}">
										<td th:text="${creCount}"
											th:if="${subject.initials == 'C.R.E'}">C.R.E</td>
										<td th:text="${ireCount}"
											th:if="${subject.initials == 'I.R.E'}">I.R.E</td>
										<td th:text="${hreCount}"
											th:if="${subject.initials == 'H.R.E'}">H.R.E</td>
										<td th:text="${__${subject.initials}__Count}"
											th:unless="${subject.initials == 'C.R.E' || subject.initials == 'I.R.E' || subject.initials == 'H.R.E'}"></td>
									</th:block>

								</tr>
							</tbody>
						</table>
					</div>

					<!--  
					<div style="text-align: center;">
						<h4>Students Grade Distribution</h4>
					</div>

					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th>Grade</th>
									<th:block th:each="subject : ${subjects}">
										<th scope="col" th:text="${subject.initials}">subject</th>
									</th:block>
									<th>Total</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>A</td>
									<th:block th:each="subject : ${subjects}">
										<td scope="col">-</td>
									</th:block>
									<td></td>
								</tr>
								<tr>
									<td>A-</td>
									<th:block th:each="subject : ${subjects}">
										<td scope="col">-</td>
									</th:block>
									<td></td>
								</tr>
							</tbody>
						</table>
					</div>

					<div style="text-align: center; padding-top: 20px;">
						<h4>Performance Analysis</h4>
						<h5>Overal Grade Distribution. (Based on Ranking).</h5>
					</div>

					<div class="table-responsive" style="padding: 20px;">
						<table class="table">
							<thead>
								<tr>
									<th>Grade</th>
									<th>A</th>
									<th>A-</th>
									<th>B+</th>
									<th>B</th>
									<th>B-</th>
									<th>C+</th>
									<th>C</th>
									<th>C-</th>
									<th>D+</th>
									<th>D</th>
									<th>D-</th>
									<th>E</th>
									<th>Y</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th>Total</th>
									<td>A</td>
									<td>A-</td>
									<td>B+</td>
									<td>B</td>
									<td>B-</td>
									<td>C+</td>
									<td>C</td>
									<td>C-</td>
									<td>D+</td>
									<td>D</td>
									<td>D-</td>
									<td>E</td>
									<td>Y</td>
								</tr>
							</tbody>
						</table>
					</div>
-->
					<div style="text-align: center;">
						<h5>Most Improved Student. (Against K.C.P.E Marks)</h5>
					</div>

					<div class="table-responsive" style="padding: 20px;">
						<table class="table">
							<thead>
								<tr>
									<th>First Name</th>
									<th>Third Name</th>
									<th>Stream</th>
									<th>Adm No</th>
								</tr>
							</thead>
							<tbody>
								<div th:if="${mostImproved == null}">
									<br>
									<p class="text text-center alert alert-warning">No Student
										Marks has been added</p>
								</div>
								<tr th:if="${mostImproved != null}">
									<td th:text="${mostImproved.firstname}">First Name</td>
									<td th:text="${mostImproved.secondname}">Second Name</td>
									<td th:text="${mostImproved.stream}">Stream</td>
									<td
										th:text="${#strings.substringAfter(mostImproved.admNo,'_')}">Adm
										No</td>
								</tr>
							</tbody>
						</table>
					</div>

					<div style="text-align: center;">
						<h5>Subject Champions</h5>
					</div>

					<th:block th:each="subject : ${subjects}">

						<h6 th:text="${subject.name}">Subject Name</h6>

						<div class="table-responsive" style="padding-bottom: 20px;">
							<table class="table">
								<thead>
									<tr>
										<th>Adm No.</th>
										<th>First Name</th>
										<th>Third Name</th>
										<th>Stream</th>
										<th>Marks</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td
											th:text="${#strings.substringAfter(__${subject.initials}__Giant.admNo,'_')}">Adm
											No.</td>
										<td th:text="${__${subject.initials}__Giant.firstname}">First
											Name</td>
										<td th:text="${__${subject.initials}__Giant.secondname}">Third
											Name</td>
										<td th:text="${__${subject.initials}__Giant.stream}">Stream</td>
										<th:block th:each="meritList : ${meritLists}">
											<td th:text="${meritList.__${subject.initials}__}"
												th:if="${subject.initials != 'C.R.E' || subject.initials != 'H.R.E' || subject.initials != 'I.R.E'}"></td>
											<td th:text="${meritList.cre}"
												th:if="${subject.initials == 'C.R.E'}"></td>
											<td th:text="${meritList.hre}"
												th:if="${subject.initials == 'H.R.E'}"></td>
											<td th:text="${meritList.ire}"
												th:if="${subject.initials == 'I.R.E'}"></td>
										</th:block>
									</tr>
								</tbody>
							</table>
						</div>
					</th:block>

				</div>
				<!-- End of Main Content -->

				<!-- Footer -->
				<footer th:replace="fragments :: footer2"></footer>
				<!-- End of Footer -->


			</div>
			<!-- End of Content Wrapper -->

		</div>
		<!-- End of Page Wrapper -->

		<!-- Scroll to Top Button-->
		<a th:replace="fragments :: scroll"></a>

		<!-- Logout modal -->
		<div th:replace="fragments :: logoutModal"></div>

		<div th:replace="fragments :: endScript"></div>
</body>

</html>
